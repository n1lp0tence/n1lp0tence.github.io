name: Download Release Assets to /files

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  download:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout destination repo
        uses: actions/checkout@v4

      - name: Ensure /files directory exists
        run: mkdir -p files
      
      - name: Download Introduction to C-Infinity Rings
        uses: robinraju/release-downloader@v1
        with:
          repository: "n1lp0tence/Introduction_to_C_Infinity_Rings"
          tag: "pdf-latest"
          fileName: "main.pdf"
          out-file-path: "files/Introduction_to_C_Infinity_Rings"
          token: ${{ secrets.SOURCE_REPO_TOKEN }}

      - name: Download The Kroneckerâ€“Weber Theorem
        uses: robinraju/release-downloader@v1
        with:
          repository: "n1lp0tence/The_Kronecker_Weber_Theorem"
          tag: "pdf-latest"
          fileName: "main.pdf"
          out-file-path: "files/The_Kronecker_Weber_Theorem"
          token: ${{ secrets.SOURCE_REPO_TOKEN }}

      - name: Commit changes if updated
        run: |
          set -euo pipefail

          if [[ -z "$(git status --porcelain)" ]]; then
            echo "No changes detected."
            exit 0
          fi

          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

          git add files/
          git commit -m "chore: sync PDFs from private releases"
          git push
